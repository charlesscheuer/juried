{"ast":null,"code":"'use strict';\n\nconst resources = require('./resources');\n\nStripe.DEFAULT_HOST = 'api.stripe.com';\nStripe.DEFAULT_PORT = '443';\nStripe.DEFAULT_BASE_PATH = '/v1/';\nStripe.DEFAULT_API_VERSION = null; // Use node's default timeout:\n\nStripe.DEFAULT_TIMEOUT = require('http').createServer().timeout;\nStripe.PACKAGE_VERSION = require('../package.json').version;\nStripe.USER_AGENT = {\n  bindings_version: Stripe.PACKAGE_VERSION,\n  lang: 'node',\n  lang_version: process.version,\n  platform: process.platform,\n  publisher: 'stripe',\n  uname: null\n};\nStripe.USER_AGENT_SERIALIZED = null;\nStripe.MAX_NETWORK_RETRY_DELAY_SEC = 2;\nStripe.INITIAL_NETWORK_RETRY_DELAY_SEC = 0.5;\nconst APP_INFO_PROPERTIES = ['name', 'version', 'url', 'partner_id'];\nconst ALLOWED_CONFIG_PROPERTIES = ['apiVersion', 'maxNetworkRetries', 'httpAgent', 'timeout', 'host', 'port', 'telemetry'];\n\nconst EventEmitter = require('events').EventEmitter;\n\nconst utils = require('./utils');\n\nStripe.StripeResource = require('./StripeResource');\nStripe.resources = resources;\n\nfunction Stripe(key, config = {}) {\n  if (!(this instanceof Stripe)) {\n    return new Stripe(key, config);\n  }\n\n  const props = this._getPropsFromConfig(config);\n\n  Object.defineProperty(this, '_emitter', {\n    value: new EventEmitter(),\n    enumerable: false,\n    configurable: false,\n    writable: false\n  });\n  this.on = this._emitter.on.bind(this._emitter);\n  this.once = this._emitter.once.bind(this._emitter);\n  this.off = this._emitter.removeListener.bind(this._emitter);\n  this._api = {\n    auth: null,\n    host: props.host || Stripe.DEFAULT_HOST,\n    port: props.port || Stripe.DEFAULT_PORT,\n    basePath: Stripe.DEFAULT_BASE_PATH,\n    version: props.apiVersion || Stripe.DEFAULT_API_VERSION,\n    timeout: utils.validateInteger('timeout', props.timeout, Stripe.DEFAULT_TIMEOUT),\n    maxNetworkRetries: utils.validateInteger('maxNetworkRetries', props.maxNetworkRetries, 0),\n    agent: props.httpAgent || null,\n    dev: false\n  };\n\n  this._prepResources();\n\n  this.setApiKey(key);\n  this.errors = require('./Error');\n  this.webhooks = require('./Webhooks');\n  this._prevRequestMetrics = [];\n  this.setTelemetryEnabled(props.telemetry !== false);\n}\n\nStripe.errors = require('./Error');\nStripe.webhooks = require('./Webhooks');\nStripe.prototype = {\n  setHost(host, port, protocol) {\n    this._setApiField('host', host);\n\n    if (port) {\n      this.setPort(port);\n    }\n\n    if (protocol) {\n      this.setProtocol(protocol);\n    }\n  },\n\n  setProtocol(protocol) {\n    this._setApiField('protocol', protocol.toLowerCase());\n  },\n\n  /**\n   * @deprecated will be removed in a future major version. Use the config object instead:\n   *\n   * const stripe = new Stripe(API_KEY, {\n   *   port: 3000,\n   * });\n   *\n   */\n  setPort(port) {\n    this._setApiField('port', port);\n  },\n\n  /**\n   * @deprecated will be removed in a future major version. Use the config object instead:\n   *\n   * const stripe = new Stripe(API_KEY, {\n   *   apiVersion: API_VERSION,\n   * });\n   *\n   */\n  setApiVersion(version) {\n    if (version) {\n      this._setApiField('version', version);\n    }\n  },\n\n  setApiKey(key) {\n    if (key) {\n      this._setApiField('auth', \"Bearer \".concat(key));\n    }\n  },\n\n  setTimeout(timeout) {\n    this._setApiField('timeout', timeout == null ? Stripe.DEFAULT_TIMEOUT : timeout);\n  },\n\n  setAppInfo(info) {\n    if (info && typeof info !== 'object') {\n      throw new Error('AppInfo must be an object.');\n    }\n\n    if (info && !info.name) {\n      throw new Error('AppInfo.name is required');\n    }\n\n    info = info || {};\n    const appInfo = APP_INFO_PROPERTIES.reduce((accum, prop) => {\n      if (typeof info[prop] == 'string') {\n        accum = accum || {};\n        accum[prop] = info[prop];\n      }\n\n      return accum;\n    }, undefined); // Kill the cached UA string because it may no longer be valid\n\n    Stripe.USER_AGENT_SERIALIZED = undefined;\n    this._appInfo = appInfo;\n  },\n\n  /**\n   * @deprecated will be removed in a future major version. Use the config object instead:\n   *\n   * const ProxyAgent = require('https-proxy-agent');\n   * const stripe = new Stripe(API_KEY, {\n   *   httpAgent: new ProxyAgent(process.env.http_proxy),\n   * });\n   *\n   */\n  setHttpAgent(agent) {\n    this._setApiField('agent', agent);\n  },\n\n  _setApiField(key, value) {\n    this._api[key] = value;\n  },\n\n  getApiField(key) {\n    return this._api[key];\n  },\n\n  setClientId(clientId) {\n    this._clientId = clientId;\n  },\n\n  getClientId() {\n    return this._clientId;\n  },\n\n  getConstant: c => {\n    return Stripe[c];\n  },\n\n  getMaxNetworkRetries() {\n    return this.getApiField('maxNetworkRetries');\n  },\n\n  /**\n   * @deprecated will be removed in a future major version. Use the config object instead:\n   *\n   * const stripe = new Stripe(API_KEY, {\n   *   maxNetworkRetries: 2,\n   * });\n   *\n   */\n  setMaxNetworkRetries(maxNetworkRetries) {\n    this._setApiNumberField('maxNetworkRetries', maxNetworkRetries);\n  },\n\n  _setApiNumberField(prop, n, defaultVal) {\n    const val = utils.validateInteger(prop, n, defaultVal);\n\n    this._setApiField(prop, val);\n  },\n\n  getMaxNetworkRetryDelay() {\n    return this.getConstant('MAX_NETWORK_RETRY_DELAY_SEC');\n  },\n\n  getInitialNetworkRetryDelay() {\n    return this.getConstant('INITIAL_NETWORK_RETRY_DELAY_SEC');\n  },\n\n  // Gets a JSON version of a User-Agent and uses a cached version for a slight\n  // speed advantage.\n  getClientUserAgent(cb) {\n    if (Stripe.USER_AGENT_SERIALIZED) {\n      return cb(Stripe.USER_AGENT_SERIALIZED);\n    }\n\n    this.getClientUserAgentSeeded(Stripe.USER_AGENT, cua => {\n      Stripe.USER_AGENT_SERIALIZED = cua;\n      cb(Stripe.USER_AGENT_SERIALIZED);\n    });\n  },\n\n  // Gets a JSON version of a User-Agent by encoding a seeded object and\n  // fetching a uname from the system.\n  getClientUserAgentSeeded(seed, cb) {\n    utils.safeExec('uname -a', (err, uname) => {\n      const userAgent = {};\n\n      for (const field in seed) {\n        userAgent[field] = encodeURIComponent(seed[field]);\n      } // URI-encode in case there are unusual characters in the system's uname.\n\n\n      userAgent.uname = encodeURIComponent(uname || 'UNKNOWN');\n\n      if (this._appInfo) {\n        userAgent.application = this._appInfo;\n      }\n\n      cb(JSON.stringify(userAgent));\n    });\n  },\n\n  getAppInfoAsString() {\n    if (!this._appInfo) {\n      return '';\n    }\n\n    let formatted = this._appInfo.name;\n\n    if (this._appInfo.version) {\n      formatted += \"/\".concat(this._appInfo.version);\n    }\n\n    if (this._appInfo.url) {\n      formatted += \" (\".concat(this._appInfo.url, \")\");\n    }\n\n    return formatted;\n  },\n\n  setTelemetryEnabled(enableTelemetry) {\n    this._enableTelemetry = enableTelemetry;\n  },\n\n  getTelemetryEnabled() {\n    return this._enableTelemetry;\n  },\n\n  _prepResources() {\n    for (const name in resources) {\n      this[utils.pascalToCamelCase(name)] = new resources[name](this);\n    }\n  },\n\n  _getPropsFromConfig(config) {\n    // If config is null or undefined, just bail early with no props\n    if (!config) {\n      return {};\n    } // config can be an object or a string\n\n\n    const isString = typeof config === 'string';\n    const isObject = config === Object(config) && !Array.isArray(config);\n\n    if (!isObject && !isString) {\n      throw new Error('Config must either be an object or a string');\n    } // If config is a string, we assume the old behavior of passing in a string representation of the api version\n\n\n    if (isString) {\n      return {\n        apiVersion: config\n      };\n    } // If config is an object, we assume the new behavior and make sure it doesn't contain any unexpected values\n\n\n    const values = Object.keys(config).filter(value => !ALLOWED_CONFIG_PROPERTIES.includes(value));\n\n    if (values.length > 0) {\n      throw new Error(\"Config object may only contain the following: \".concat(ALLOWED_CONFIG_PROPERTIES.join(', ')));\n    }\n\n    return config;\n  }\n\n};\nmodule.exports = Stripe; // expose constructor as a named property to enable mocking with Sinon.JS\n\nmodule.exports.Stripe = Stripe;","map":null,"metadata":{},"sourceType":"script"}